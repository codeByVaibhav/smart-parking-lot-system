// Prisma schema for Smart Parking Lot System
// Uses SQLite for local development; can switch to PostgreSQL by updating datasource

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum VehicleType {
  MOTORCYCLE
  CAR
  BUS
}

enum SpotType {
  MOTORCYCLE
  CAR
  BUS
}

model Vehicle {
  id            String          @id @default(cuid())
  numberPlate   String          @unique
  type          VehicleType
  tickets       ParkingTicket[]
  createdAt     DateTime        @default(now())
}

model Floor {
  id        String         @id @default(cuid())
  level     Int
  name      String
  spots     ParkingSpot[]
  createdAt DateTime       @default(now())

  @@unique([level, name], name: "level_name")
}

model ParkingSpot {
  id          String       @id @default(cuid())
  code        String
  type        SpotType
  isOccupied  Boolean      @default(false)
  floorId     String
  floor       Floor        @relation(fields: [floorId], references: [id], onDelete: Cascade)
  tickets     ParkingTicket[]

  @@unique([floorId, code], name: "floorId_code")
  @@index([type, isOccupied])
}

model ParkingTicket {
  id            String       @id @default(cuid())
  vehicleId     String
  vehicle       Vehicle      @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  spotId        String
  spot          ParkingSpot  @relation(fields: [spotId], references: [id], onDelete: Cascade)
  entryTime     DateTime     @default(now())
  exitTime      DateTime?
  feeCents      Int?
  closed        Boolean      @default(false)

  @@index([vehicleId, closed])
  @@index([spotId, closed])
}
